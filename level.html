<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cervical Cancer Awareness Analysis</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }
      th,
      td {
        border: 1px solid #ccc;
        padding: 10px;
        text-align: center;
      }
      th {
        background-color: #f4f4f4;
      }
      input,
      textarea {
        margin: 5px;
        padding: 5px;
        width: calc(100% - 12px);
      }
    </style>
  </head>
  <body>
    <h2>Cervical Cancer Awareness Analysis</h2>

    <div>
      <h3>Paste Data</h3>
      <textarea
        id="data-input"
        rows="10"
        placeholder="Paste your data here (format: statement, YES, NO, NOT SURE)"
      ></textarea>
      <button onclick="pasteData()">Paste Data</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>Statement</th>
          <th>YES (N)</th>
          <th>NO (N)</th>
          <th>NOT SURE (N)</th>
          <th>Knowledge Level</th>
          <th>Mean ± Std Dev</th>
        </tr>
      </thead>
      <tbody id="table-body">
        <!-- Data will be inserted here -->
      </tbody>
    </table>

    <button onclick="calculateData()">Calculate Data</button>
    <button onclick="copyAll()">Copy Table and Summary</button>

    <h3>Summary</h3>
    <div id="summary-explanation">
      <!-- Summary explanation will be inserted here -->
    </div>

    <script>
      let data = [];

      function pasteData() {
        const input = document.getElementById("data-input").value.trim();
        const lines = input.split("\n");

        data.length = 0; // Clear previous data

        lines.forEach((line) => {
          const parts = line.split("\t").map((part) => part.trim());
          if (parts.length === 4) {
            // Expecting 4 parts: statement, YES, NO, NOT SURE
            const [statement, yes, no, notSure] = parts;
            const yesNum = parseInt(yes) || 0;
            const noNum = parseInt(no) || 0;
            const notSureNum = parseInt(notSure) || 0;

            // Store data
            data.push({
              statement,
              yes: yesNum,
              no: noNum,
              notSure: notSureNum,
            });
          }
        });

        populateTable();
        document.getElementById("data-input").value = ""; // Clear the input area
        alert("Data pasted successfully!");
      }

      function populateTable() {
        const tableBody = document.getElementById("table-body");
        tableBody.innerHTML = ""; // Clear previous table rows

        data.forEach((item) => {
          const total = item.yes + item.no + item.notSure; // Calculate total for the row

          const knowledgeLevel =
            total > 0 && item.yes / total > 0.5 ? "Good" : "Moderate";

          const row = `
                    <tr>
                        <td>${item.statement}</td>
                        <td>${item.yes} (${((item.yes / total) * 100).toFixed(
            1
          )}%)</td>
                        <td>${item.no} (${((item.no / total) * 100).toFixed(
            1
          )}%)</td>
                        <td>${item.notSure} (${(
            (item.notSure / total) *
            100
          ).toFixed(1)}%)</td>
                        <td>${knowledgeLevel}</td>
                        <td>To be calculated</td>
                    </tr>
                `;
          tableBody.innerHTML += row;
        });
      }

      function calculateData() {
        const tableBody = document.getElementById("table-body");
        tableBody.innerHTML = ""; // Clear previous table rows

        data.forEach((item) => {
          const total = item.yes + item.no + item.notSure;

          // Calculate mean
          const mean = (item.yes * 3 + item.no * 2 + item.notSure * 1) / total;
          const stdDev = Math.sqrt(
            (item.yes * Math.pow(3 - mean, 2) +
              item.no * Math.pow(2 - mean, 2) +
              item.notSure * Math.pow(1 - mean, 2)) /
              total
          ).toFixed(2);

          const knowledgeLevel =
            total > 0 && item.yes / total > 0.5 ? "Good" : "Moderate";

          const row = `
                    <tr>
                        <td>${item.statement}</td>
                        <td>${item.yes} (${((item.yes / total) * 100).toFixed(
            1
          )}%)</td>
                        <td>${item.no} (${((item.no / total) * 100).toFixed(
            1
          )}%)</td>
                        <td>${item.notSure} (${(
            (item.notSure / total) *
            100
          ).toFixed(1)}%)</td>
                        <td>${knowledgeLevel}</td>
                        <td>${mean.toFixed(2)} ± ${stdDev}</td>
                    </tr>
                `;
          tableBody.innerHTML += row;
        });

        generateSummary();
      }

      function generateSummary() {
        const explanationDiv = document.getElementById("summary-explanation");
        explanationDiv.innerHTML = ""; // Clear previous explanation

        const totalResponses = data.reduce(
          (sum, item) => sum + item.yes + item.no + item.notSure,
          0
        );
        const totalYes = data.reduce((sum, item) => sum + item.yes, 0);
        const totalNo = data.reduce((sum, item) => sum + item.no, 0);
        const totalNotSure = data.reduce((sum, item) => sum + item.notSure, 0);

        const summary = `
                <p>Total Responses: ${totalResponses}</p>
                <p>Respondents who answered YES: ${totalYes} (${(
          (totalYes / totalResponses) *
          100
        ).toFixed(1)}%)</p>
                <p>Respondents who answered NO: ${totalNo} (${(
          (totalNo / totalResponses) *
          100
        ).toFixed(1)}%)</p>
                <p>Respondents who answered NOT SURE: ${totalNotSure} (${(
          (totalNotSure / totalResponses) *
          100
        ).toFixed(1)}%)</p>
            `;
        explanationDiv.innerHTML = summary;
      }

      function copyAll() {
        // Create a temporary element to hold the table and summary data
        const tempDiv = document.createElement("div");

        // Create the table
        const table = document.createElement("table");
        table.innerHTML = document.querySelector("table").innerHTML; // Copy the current table structure
        tempDiv.appendChild(table);

        // Create the summary section
        const summaryDiv = document.getElementById(
          "summary-explanation"
        ).innerHTML;
        const summarySection = document.createElement("div");
        summarySection.innerHTML = summaryDiv;
        tempDiv.appendChild(summarySection);

        // Append the tempDiv to the body to make it selectable
        document.body.appendChild(tempDiv);

        // Copy the content
        const selection = window.getSelection();
        const range = document.createRange();
        range.selectNode(tempDiv);
        selection.removeAllRanges();
        selection.addRange(range);

        try {
          const successful = document.execCommand("copy");
          alert(
            successful
              ? "Table and summary copied to clipboard!"
              : "Failed to copy."
          );
        } catch (err) {
          alert("Failed to copy.");
        }

        document.body.removeChild(tempDiv); // Clean up
      }
    </script>
  </body>
</html>
